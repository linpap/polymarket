# Polymarket Paper Trader

## Project Overview
TypeScript/Node.js paper trading bot for Polymarket prediction markets. Two-stage AI pipeline (batch screen with Haiku -> deep analyze with Sonnet), Kelly criterion sizing, web research for real-time context.

## Architecture
- `src/scanner.ts` — Fetches binary markets from Gamma API, filters by liquidity/time-to-resolution
- `src/estimator.ts` — Stage 1 batch screening (Haiku) + Stage 2 deep analysis (Sonnet) with Claude API
- `src/analyzer.ts` — Market categorization, signal evaluation with shrinkage calibration, asymmetric payoff preference
- `src/sizer.ts` — Kelly criterion position sizing with asymmetric caps and max loss limits
- `src/research.ts` — Web research via Claude tool_use before Stage 2 analysis
- `src/paper-trader.ts` — Main loop: scan -> screen -> analyze -> size -> record trades -> check resolutions
- `src/resolver.ts` — Checks if paper trades have resolved (YES/NO outcome)
- `src/reporter.ts` — Generates performance reports
- `src/config.ts` — All trading params, API keys, category multipliers
- `src/types.ts` — TypeScript interfaces
- `src/logger.ts` — Logging utility
- `state/paper-trades.json` — Persistent state (trades, bankroll, API costs)
- `scripts/paper-trade.ts` — Entry point

## Key Trading Logic
- **Shrinkage**: adjustedFair = market + 0.45 * (ourFair - market) — trust 45% of our edge
- **Category multipliers**: speech (1.3), political (1.2), niche (1.1), financial (1.0), sports (0.8), crypto (0.5), esports (0.5), weather (0.5)
- **Asymmetric payoff**: Prefers cheap side (< 0.45) for better risk/reward. Mid-price markets (0.40-0.60) require 50% more edge
- **Position sizing**: Cheap bets (< 35c) up to 15%, mid (35-50c) up to 12%, expensive (> 50c) capped at 8%. Max loss per trade: $75 or 7.5% bankroll
- **Ensemble**: Currently single model (Sonnet) for cost savings. Can enable multi-model agreement
- **Anti-momentum**: Prompt warns Claude to be skeptical of counter-trend bets

## Build & Run
```bash
npx tsc                              # Compile TypeScript
node dist/scripts/paper-trade.js     # Run single cycle + loop every 30min
```

## Environment Variables (.env)
- `ANTHROPIC_API_KEY` — Required for Claude API calls
- `LOG_LEVEL` — "info" (default) or "debug"

## Lessons Learned
- NO bets near 50% (48.5c) have terrible risk/reward — lost $111 on XRP
- Crypto prices are random walks, Claude can't predict short-term moves — crypto multiplier at 0.5
- Cheap underdog bets (26.5c YES) have great asymmetry — won $60 on basketball
- Kelly oversizes when "edge" looks large but is noise — max loss cap prevents blowups
- Always verify with `npx tsc` after changes — clean builds only
